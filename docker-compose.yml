version: '3.8'

services:
  # Express backend service
  backend:
    build: .
    container_name: famlink-backend
    ports:
      - "4000:4000"  # Exposing backend API on port 4000
    env_file:
      - .env  # Ensure this loads environment variables like MONGO_URI
    environment:
      - MONGO_URI=${MONGO_URI}  # MongoDB URI from .env file
      - JWT_SECRET=${JWT_SECRET}
      - JWT_EXPIRES_IN=${JWT_EXPIRES_IN}
      - CORS_ORIGIN=${CORS_ORIGIN}
    depends_on:
      - mongodb  # Ensures backend starts only after MongoDB is up
    restart: always
    networks:
      - famlink-net

  # MongoDB service (running on your VPS, not in this Docker setup)
  # This service just links to the existing MongoDB running on your VPS
  mongodb:
    container_name: mongodb  # Can be any name, since it's a reference to the remote service
    image: mongo:7.0
    ports:
      - "27017:27017"  # Expose MongoDB to the host on port 27017
    volumes:
      - /home/ubuntu/mongo_data:/data/db  # Persist MongoDB data (ensure directory exists)
    restart: always
    networks:
      - famlink-net

networks:
  famlink-net:
    driver: bridge

volumes:
  mongo-data:
    driver: local  # Use local driver for MongoDB data persistence
